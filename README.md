---
title: Cached RAG
emoji: üåç
colorFrom: orange
colorTo: purple
sdk: docker
pinned: false
license: mit
short_description: Sample RAG app that implements caching
---

# Cached RAG

## Overview

Cached RAG is a sample Retrieval-Augmented Generation (RAG) application that demonstrates how to implement caching for embeddings and responses. It uses Chainlit for the chat interface, LangChain for orchestration, and Qdrant as the vector store. The app loads documents, splits them into chunks, embeds them, and allows users to query the content with responses generated by a language model.

## How to Run

### Prerequisites

- Python 3.9+
- [uv](https://github.com/astral-sh/uv) (for dependency management)
- [Docker](https://www.docker.com/) (optional, for containerized runs)

#### MongoDB Document Store:

1. [Pull latest MongoDB image from Dockerhub](https://hub.docker.com/_/mongo): `docker pull mongo`

2. Set the env variables `MONGO_DOC_STORE_HOST` and `MONGO_DOC_STORE_PORT` in the `.env` file.

3. Run MongoDB in a container:

```
docker run -p 27017:27017 \
   -v "$(pwd)/mongo_storage:/data/db" \
   --name mongo-docstore -d mongo:latest
```

This assumes `MONGO_DOC_STORE_PORT=27017`.

#### Qdrant Vector Store:

1. [Pull latest Qdrant image from Dockerhub](https://hub.docker.com/r/qdrant/qdrant): `docker pull qdrant/qdrant`

2. Set the env variables `QDRANT_HOST` and `QDRANT_PORT` in the `.env` file.

3. Run Qdrant in a container:

```
docker run -p 6333:6333 -p 6334:6334 \
   -v "$(pwd)/qdrant_storage:/qdrant/storage:z" \
   qdrant/qdrant
```

This assumes `QDRANT_PORT=6333`

#### Redis (LLM Semantic Cache):

1. [Pull latest Redis image from Dockerhub](https://hub.docker.com/_/redis): `docker pull redis`

2. Set the env variables `REDIS_HOST` and `REDIS_PORT` in the `.env` file.

3. Run Redis in a container:

```
docker run -d --name redis-llm-cache \
  -p 6379:6379 -p 8001:8001 \
  -v "$(pwd)/redis_storage:/data" \
  redis/redis-stack:latest
```

This assumes `REDIS_PORT=6379`

### Environment Variables

Create a `.env` file in the project root by copying the file `.env.sample` and assign values to the keys. The keys `LANGCHAIN_TRACING_V2` and `LANGCHAIN_API_KEY` are optional.

### Local Run

1. Install dependencies:
   ```bash
   uv sync
   ```
2. Start the app (use the --watch flag to start the app in reload mode):
   ```bash
   uv run chainlit run app.py --host 0.0.0.0 --port 7860 --watch
   ```
3. Open your browser and go to [http://localhost:7860](http://localhost:7860)

### Docker Run

1. Build the Docker image:
   ```bash
   docker build -t cached-rag .
   ```
2. Run the container:
   ```bash
   docker run --env-file .env -p 7860:7860 cached-rag
   ```

## Debugging

- **View Logs**: Logs are printed to the console. If running via Docker, use `docker logs <container_id>`.
- **Development Mode**: You can edit `app.py` and restart the server to see changes. For rapid iteration, run locally rather than in Docker.
- **Check Environment Variables**: Ensure your `.env` file is present and variables are set correctly. Missing or incorrect values will cause startup errors.
- **Dependency Issues**: If you encounter import errors, re-run `uv sync` to ensure all dependencies are installed.
- **Chainlit Debugging**: For more verbose output, set the `CHAINLIT_LOG_LEVEL=DEBUG` environment variable before running the app.

To debug using the Python Debugger (VSCode or Cursor):

- Ensure the python interpreter (Python: Select Interpreter) corresponds to the same one found in the `.venv` directory.

## References

- [Chainlit Documentation](https://docs.chainlit.io/)
- [LangChain Documentation](https://python.langchain.com/)
- [Qdrant Documentation](https://qdrant.tech/documentation/)

Check out the configuration reference at https://huggingface.co/docs/hub/spaces-config-reference
